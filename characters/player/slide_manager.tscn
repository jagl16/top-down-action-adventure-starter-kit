[gd_scene load_steps=4 format=3 uid="uid://b3e7x461r08yg"]

[ext_resource type="FontFile" uid="uid://dgn5mdix5re20" path="res://ui/fonts/Montserrat-Bold.ttf" id="2_font"]

[sub_resource type="GDScript" id="GDScript_iqj88"]
script/source = "extends Node
class_name SlideManager

# Signals for state changes
signal slide_ready
signal slide_started
signal slide_ended
signal cooldown_started
signal cooldown_ended

# Configuration
@export var slide_cooldown: float = 1.5  # Cooldown after slide ends
@export var slide_duration: float = 0.9  # How long slide lasts

# UI Elements
@export var ui_container: Control
@export var cooldown_indicator: ProgressBar
@export var cooldown_overlay: ColorRect

# Visual states
var ready_color: Color = Color(0.3, 0.8, 0.3)  # Green
var cooldown_color: Color = Color(0.8, 0.3, 0.2)  # Red

# State
enum SlideState { READY, SLIDING, COOLDOWN }
var current_state: SlideState = SlideState.READY

# Internal timers
var slide_timer: float = 0.0
var cooldown_timer: float = 0.0

func _ready():
	_update_ui()

func _process(delta: float):
	match current_state:
		SlideState.SLIDING:
			slide_timer -= delta
			if slide_timer <= 0:
				_enter_cooldown_state()

		SlideState.COOLDOWN:
			cooldown_timer -= delta
			_update_cooldown_ui()
			if cooldown_timer <= 0:
				_enter_ready_state()

# Public API
func request_slide() -> bool:
	\"\"\"Returns true if slide is allowed, false if on cooldown\"\"\"
	if current_state == SlideState.READY:
		_enter_sliding_state()
		return true
	else:
		return false  # SLIDING or COOLDOWN

func can_slide() -> bool:
	\"\"\"Check if slide is available without triggering it\"\"\"
	return current_state == SlideState.READY

func is_sliding() -> bool:
	return current_state == SlideState.SLIDING

func is_on_cooldown() -> bool:
	return current_state == SlideState.COOLDOWN

# State transitions
func _enter_sliding_state():
	current_state = SlideState.SLIDING
	slide_timer = slide_duration
	slide_started.emit()
	_update_ui()

func _enter_cooldown_state():
	current_state = SlideState.COOLDOWN
	cooldown_timer = slide_cooldown
	slide_ended.emit()
	cooldown_started.emit()
	_show_cooldown_overlay(true)
	_update_ui()

func _enter_ready_state():
	current_state = SlideState.READY
	slide_ready.emit()
	cooldown_ended.emit()
	_show_cooldown_overlay(false)
	_update_ui()

# UI Update Methods
func _update_ui():
	if not cooldown_indicator:
		return

	if current_state == SlideState.READY:
		cooldown_indicator.value = 100.0
		cooldown_indicator.modulate = ready_color
	elif current_state == SlideState.SLIDING:
		cooldown_indicator.value = 100.0
		cooldown_indicator.modulate = ready_color
	elif current_state == SlideState.COOLDOWN:
		var percentage = (1.0 - (cooldown_timer / slide_cooldown)) * 100.0
		cooldown_indicator.value = percentage
		cooldown_indicator.modulate = cooldown_color

func _update_cooldown_ui():
	if not cooldown_indicator:
		return

	var percentage = (1.0 - (cooldown_timer / slide_cooldown)) * 100.0
	cooldown_indicator.value = percentage

	# Animate cooldown overlay fade
	if cooldown_overlay and cooldown_overlay.visible:
		var alpha = cooldown_timer / slide_cooldown
		var overlay_color = cooldown_overlay.color
		overlay_color.a = 0.4 * alpha
		cooldown_overlay.color = overlay_color

func _show_cooldown_overlay(show: bool):
	if cooldown_overlay:
		cooldown_overlay.visible = show
"

[sub_resource type="LabelSettings" id="LabelSettings_slide"]
font = ExtResource("2_font")
font_size = 18
outline_color = Color(0.221665, 0.221665, 0.221665, 1)
shadow_size = 2
shadow_color = Color(0, 0, 0, 0.673)
shadow_offset = Vector2(3, 1)

[node name="SlideManager" type="Node" node_paths=PackedStringArray("ui_container", "cooldown_indicator", "cooldown_overlay")]
script = SubResource("GDScript_iqj88")
ui_container = NodePath("UIContainer")
cooldown_indicator = NodePath("UIContainer/VBoxContainer/SlideCooldownBar")
cooldown_overlay = NodePath("UIContainer/CooldownOverlay")

[node name="UIContainer" type="Control" parent="."]
layout_mode = 3
anchors_preset = 2
anchor_top = 1.0
anchor_bottom = 1.0
offset_left = 16.0
offset_top = -104.0
offset_right = 216.0
offset_bottom = -54.0
grow_vertical = 0
mouse_filter = 2

[node name="VBoxContainer" type="VBoxContainer" parent="UIContainer"]
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2

[node name="Label" type="Label" parent="UIContainer/VBoxContainer"]
layout_mode = 2
text = "SLIDE"
label_settings = SubResource("LabelSettings_slide")

[node name="SlideCooldownBar" type="ProgressBar" parent="UIContainer/VBoxContainer"]
custom_minimum_size = Vector2(0, 16)
layout_mode = 2
value = 100.0
show_percentage = false

[node name="CooldownOverlay" type="ColorRect" parent="UIContainer"]
visible = false
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
mouse_filter = 2
color = Color(0.8, 0.2, 0.1, 0.4)
